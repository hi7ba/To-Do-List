<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To Do List</title>
    <link rel="stylesheet" href="css/style2.css">
</head>
<body>
    <div class="container">
        <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
        <aside class="sidebar">
            <h2>TO DO LIST</h2>
            <ul id="page-list">
                <!-- Pages (lists) will be loaded dynamically here -->
            </ul>
            <button class="add-page">âž• Add List</button>
            <button class="logout">â¬… Log out</button>
        </aside>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <main class="main-content">
            <h2 id="current-page-title">Select a List</h2>
            <section class="task-list"></section>
            <button class="add-task" style="display: none;">âž• Add Task</button>
        </main>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
        fetchPages();
    });

    let currentPageId = null;

    // Fetch pages (lists) from the database
    function fetchPages() {
        fetch("get_lists.php")
        .then(response => response.json())
        .then(data => {
            let pageList = document.querySelector("#page-list");
            pageList.innerHTML = ""; // Clear existing lists
            data.forEach(page => {
                let li = document.createElement("li");
                li.textContent = page.title;
                li.dataset.pageId = page.idx;
                li.addEventListener("click", function() {
                    currentPageId = this.dataset.pageId;
                    document.querySelector("#current-page-title").textContent = page.title;
                    document.querySelector(".add-task").style.display = "block";
                    fetchTasks(currentPageId);
                });
                pageList.appendChild(li);
            });
        })
        .catch(error => console.error("Error fetching lists:", error));
    }

    // Fetch tasks for a selected list
    function fetchTasks(pageId) {
        fetch(`get_tasks.php?page_id=${pageId}`)
        .then(response => response.json())
        .then(data => {
            let taskList = document.querySelector(".task-list");
            taskList.innerHTML = ""; // Clear existing tasks
            data.forEach(task => {
                let taskDiv = document.createElement("div");
                taskDiv.className = "task blue";
                taskDiv.innerHTML = `<span class="pin">ðŸ“Œ</span>
                                     <h3>${task.title}</h3>
                                     <p>${task.description || ''}</p>`;
                taskList.appendChild(taskDiv);
            });
        })
        .catch(error => console.error("Error fetching tasks:", error));
    }

    // Add a new list (page)
    document.querySelector(".add-page").addEventListener("click", function() {
        let listTitle = prompt("Enter new list title:");
        if (listTitle) {
            fetch("add_list.php", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `title=${encodeURIComponent(listTitle)}`
            })
            .then(response => response.json())
            .then(() => fetchPages()) // Refresh page list
            .catch(error => console.error("Error adding list:", error));
        }
    });

    // Add a new task to the selected list
    document.querySelector(".add-task").addEventListener("click", function() {
        if (!currentPageId) {
            alert("Please select a list first.");
            return;
        }
        let taskTitle = prompt("Enter task title:");
        if (taskTitle) {
            fetch("add_task.php", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: `page_id=${encodeURIComponent(currentPageId)}&title=${encodeURIComponent(taskTitle)}`
            })
            .then(response => response.json())
            .then(() => fetchTasks(currentPageId)) // Refresh task list
            .catch(error => console.error("Error adding task:", error));
        }
    });

    // Logout function
    document.querySelector(".logout").addEventListener("click", function() {
        fetch("logout.php", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" }
        })
        .then(() => window.location.href = "login.html")
        .catch(error => console.error("Error logging out:", error));
    });
    </script>
</body>
</html>
